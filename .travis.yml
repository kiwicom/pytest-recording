# Config file for automatic testing at travis-ci.org

sudo: false
language: python
cache: pip

stages:
  - linters
  - tests

addons:
  apt:
    packages:
      - libgnutls-dev

env:
  global:
    - PYCURL_SSL_LIBRARY=gnutls

matrix:
  include:
    - stage: linters
      python: 3.7
      env: TOX_ENV=pylint
    - stage: linters
      python: 3.7
      env: TOX_ENV=black
    - stage: tests
      python: 2.7
      env: TOX_ENV=py27
    - stage: tests
      python: 3.5
      env: TOX_ENV=py35
    - stage: tests
      python: 3.6
      env: TOX_ENV=py36
    - stage: tests
      python: 3.7
      env: TOX_ENV=py37
    - stage: tests
      python: 3.8-dev
      dist: xenial
      env: TOX_ENV=py38
    - stage: tests
      python: pypy
      dist: xenial
      env: TOX_ENV=pypy
    - stage: tests
      python: pypy3
      dist: xenial
      env: TOX_ENV=pypy3
    - stage: tests
      python: 3.7
      env: TOX_ENV=no_pycurl

install:
  - pip install tox codecov

script:
  - tox -e $TOX_ENV

before_cache:
  - rm -rf $HOME/.cache/pip/log

after_success:
  - codecov
